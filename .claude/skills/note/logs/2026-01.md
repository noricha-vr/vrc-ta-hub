# 2026-01

## 2026-01-28

### Django save() の update_fields と画像処理の落とし穴
- **状況**: Webhook URL更新時に `community.save(update_fields=['notification_webhook_url'])` を実行
- **問題**: `FileNotFoundError` が発生。パスが `/app/media/poster/poster/poster/.../image.jpeg` と多重ネストしていた
- **原因**: 2つの問題が重なっていた
  1. `Community.save()` が `update_fields` を無視して毎回 `resize_and_convert_image()` を実行
  2. `resize_and_convert_image()` がファイル名に `poster/` を含め、`upload_to='poster/'` に保存するため `poster/poster/...` になった
- **解決**:
  1. `save()` で `update_fields` をチェックし、`poster_image` が含まれない場合はリサイズ処理をスキップ
  2. `os.path.basename()` でファイル名のみを抽出し、ディレクトリパスを除去
- **昇格**: how/django.md
