# LT申請カスタムフィールド機能 要件定義書

## 概要

集会ごとに異なるLT申請時の確認項目を、少ない実装工数で実現する機能。

### 解決する課題

- 集会によって登壇者に確認したい項目が異なる（例: 動画撮影の可否、発表の前提知識など）
- 現在のLT申請フォームは固定フィールド（テーマ、発表者名、発表時間）のみ
- 集会運営者がカスタマイズできる仕組みがない

### 提供する価値

- 運営は集会設定でテンプレート（プレースホルダー）を設定できる
- 登壇者はテンプレートを見ながら必要情報を入力できる
- 入力漏れはバリデーションで防止できる

---

## 機能要件

### FR-1: 運営向け設定機能

| ID | 要件 | 優先度 |
|----|------|--------|
| FR-1.1 | Community設定画面でテンプレートを入力できる | 必須 |
| FR-1.2 | テンプレートは複数行のテキストエリアで入力する | 必須 |
| FR-1.3 | 最低文字数を設定できる（0で無効化） | 必須 |
| FR-1.4 | テンプレートが空の場合、申請フォームに追加情報フィールドを表示しない | 必須 |

**デフォルト値:**

| フィールド | デフォルト値 |
|-----------|-------------|
| テンプレート | 空（運営が設定するまで非表示） |
| 最低文字数 | 0（バリデーション無効） |

**テンプレート例:**
```
【発表概要】

【対象者】

【必要な前提知識】

【動画撮影】OK / NG / 公開OK
```

### FR-2: 登壇者向け申請機能

| ID | 要件 | 優先度 |
|----|------|--------|
| FR-2.1 | LT申請フォームにテンプレートがプレースホルダーとして表示される | 必須 |
| FR-2.2 | テンプレートを変更せずに送信するとエラーになる | 必須 |
| FR-2.3 | 最低文字数未満で送信するとエラーになる | 必須 |
| FR-2.4 | 入力内容はEventDetailに保存される | 必須 |

### FR-3: 運営向けレビュー機能

| ID | 要件 | 優先度 |
|----|------|--------|
| FR-3.1 | LT申請レビュー画面で追加情報が表示される | 必須 |
| FR-3.2 | Discord Webhook通知に追加情報を含める | 必須 |

---

## 非機能要件

### NFR-1: 実装工数

- 最小限の変更で実現する（2〜3フィールド追加程度）
- 既存のLT申請フローを壊さない

### NFR-2: 後方互換性

- テンプレートが設定されていない既存の集会は現在の動作を維持
- 既存のEventDetailデータに影響を与えない

---

## データ設計

### Communityモデル（追加フィールド）

| フィールド名 | 型 | デフォルト | 説明 |
|-------------|-----|-----------|------|
| `lt_application_template` | TextField | 空文字 | LT申請時のテンプレート |
| `lt_application_min_length` | PositiveIntegerField | 0 | 追加情報の最低文字数（0で無効） |

### EventDetailモデル（追加フィールド）

| フィールド名 | 型 | デフォルト | 説明 |
|-------------|-----|-----------|------|
| `additional_info` | TextField | 空文字 | 登壇者が入力した追加情報 |

---

## 画面設計

### Community設定画面

```
LT申請設定
──────────────────────────────────
LT申請受付 [ON/OFF]

追加情報テンプレート
┌─────────────────────────────────┐
│ 【発表概要】                      │
│                                 │
│ 【対象者】                        │
│                                 │
│ 【動画撮影】OK / NG / 公開OK       │
└─────────────────────────────────┘
※ 空の場合、申請フォームに追加情報欄は表示されません

最低文字数 [    0    ] 文字
※ 0の場合、文字数チェックは行いません
```

### LT申請フォーム

```
LT発表申請
──────────────────────────────────
開催日    [2025/02/15 ▼]
テーマ    [________________________]
発表者名  [________________________]
発表時間  [  15  ] 分

追加情報
┌─────────────────────────────────┐
│ 【発表概要】                      │  ← プレースホルダー
│                                 │
│ 【対象者】                        │
│                                 │
│ 【動画撮影】OK / NG / 公開OK       │
└─────────────────────────────────┘

[申請する]
```

### LT申請レビュー画面

```
LT申請詳細
──────────────────────────────────
申請者    : のりちゃ
テーマ    : VRChatでの技術共有について
発表時間  : 15分
ステータス: 審査中

追加情報:
┌─────────────────────────────────┐
│ 【発表概要】                      │
│ VRChat内でLTを行う際のノウハウを   │
│ 紹介します。                      │
│                                 │
│ 【対象者】                        │
│ VRChat初心者〜中級者              │
│                                 │
│ 【動画撮影】公開OK                 │
└─────────────────────────────────┘

[承認] [却下]
```

---

## バリデーション仕様

### テンプレート同一性チェック

```python
if input_text.strip() == template.strip():
    raise ValidationError("テンプレートの各項目を入力してください")
```

### 最低文字数チェック

```python
if min_length > 0 and len(input_text) < min_length:
    raise ValidationError(f"最低{min_length}文字以上入力してください")
```

---

## Discord Webhook通知

### 新規申請通知（追加フィールド）

```json
{
  "embeds": [{
    "title": "新規LT申請",
    "fields": [
      { "name": "テーマ", "value": "VRChatでの技術共有について" },
      { "name": "発表者", "value": "のりちゃ" },
      { "name": "発表時間", "value": "15分" },
      { "name": "追加情報", "value": "【発表概要】\nVRChat内でLTを行う際の..." }
    ]
  }]
}
```

---

## 受け入れ確認手順

- [ ] 運営が集会設定画面でテンプレートと最低文字数を設定できる
- [ ] テンプレートが空の集会では、LT申請フォームに追加情報欄が表示されない
- [ ] テンプレートが設定された集会では、LT申請フォームにプレースホルダーとして表示される
- [ ] テンプレートを変更せずに送信するとエラーメッセージが表示される
- [ ] 最低文字数未満で送信するとエラーメッセージが表示される
- [ ] LT申請レビュー画面で追加情報が表示される
- [ ] Discord Webhook通知に追加情報が含まれる

---

## 将来の拡張候補

以下は今回のスコープ外だが、将来的に検討可能:

- [ ] JSONフォームビルダー（GUIでフォーム項目を定義）
- [ ] テンプレートライブラリ（他集会のテンプレートを参考に）
- [ ] Event単位でのテンプレート上書き
- [ ] 必須/任意フィールドの設定

---

## 関連ドキュメント

- [イベント管理システム](../event_management.md)
- [コミュニティ管理](../community_management.md)
